/**
 *  Jquery fbStories 1.0
 *  https://github.com/lianglee/jquery.fbStories
 * 
 *  A UI for stories similar to facebook
 *  Licensed under the Open Source Social Network License (4.0) (Cryptographic Autonomy License version 1.0)
 *
 *  https://www.opensource-socialnetwork.org/licence/v4.0.html
 * 
 * Copyright (C) 2014-2020 SYED ARSALAN HUSSAIN SHAH arsalan@buddyexpress.net,
 * Copyright (C) 2014-2020 OPEN SOURCE SOCIAL NETWORK https://www.opensource-socialnetwork.org,
 **/
 !function(t){var e=1,s=0,i=0,a=0,n=!1,r=1;t.fn.fbStories=function(o){var l=t.extend({barColor:"#F06",delay:1,dataurl:"./json.php",page_limit:5,showAdd:!0,addText:"&#43;",onShow:function(t,e){}},o),d=this;if(!l.dataurl)return console.log("There is no data URL"),!1;function c(t){clearInterval(s),r=0,u(e+=t)}function u(s){var a,n=document.getElementsByClassName("fbstories-slides");for(s>n.length&&(e=n.length),s<1&&(e=1),a=0;a<n.length;a++)n[a].style.display="none";t(".slideshow-container .total-images .current").text(e),n[e-1].style.display="block",l.onShow(n[e-1].getAttribute("data-guid"),n[e-1].getAttribute("data-url")),$time=n[e-1].getAttribute("data-time"),t(".fbstories-container .user-name-time .time").html($time),e<=i&&showProgress()}return t("body").on("mouseover",".fbstories-container .slideshow-container",function(){n=!0}),t("body").on("mouseleave",".fbstories-container .slideshow-container",function(){n=!1}),showProgress=function(){t(".fbstories-container .status-bar").hide(),t(".fbstories-container .status-bar").progressbar({value:0}),t(".fbstories-container .status-bar .ui-progressbar-value").css({background:l.barColor}),t(".fbstories-container .status-bar").show(),s=setInterval(function(){r>=100&&e>=i&&(clearInterval(s),clearInterval(a));0==n&&(r>=100&&e>=i?clearInterval(s):(r++,t(".status-bar").progressbar({value:r})))},l.delay/100*1e3)},d.prepend('<div class="fbstories-outside-container"> <div class="fbstories-items"></div> <div class="buttons"> <a class="fbstories-item-previous" href="javascript:void(0);"><</a> <a class="fbstories-item-next" href="javascript:void(0);">></a></div></div>'),t("body").prepend('<div class="fbstories-container"> <div class="fbstories-container-inner"> </div> </div>'),l.showAdd&&t(".fbstories-items").prepend('<div class="fbstories-item-add" style="float:left;"> <div class="image0th"> <a class="fbstories-add-story" href="javascript:void(0);">'+l.addText+"</a></div></div>"),t.get(l.dataurl,function(e){e[0].files&&e[0].files.length>0&&($thumbs=[],t.each(e,function(){$file=this.files[0],$border="",$file.viewed&&1==$file.viewed&&($border=" story-viewed"),$thumbs.push({thumb:$file,owner:this.owner,data:this,border:$border})}),$pagination=Math.ceil($thumbs.length/l.page_limit),$thumbspages=function(t,e){var s=0,i=t.length,a=[];for(s=0;s<i;s+=e)myChunk=t.slice(s,s+e),a.push(myChunk);return a}($thumbs,l.page_limit),1==$pagination?t(".fbstories-outside-container .buttons").hide():t(".fbstories-outside-container .buttons").show(),$thumbspages.length>0&&($count=1,$thumbnails="",t.each($thumbspages,function(){$item='<div class="fbstories-paginate-item" id="fbstories-paginate-'+$count+'">',this.length>0&&t.each(this,function(){$item+='<div class="fbstories-item'+this.border+"\" data-items='"+JSON.stringify(this.data)+'\'> <div class="user-image"> <img src="'+this.owner.icon+'" width="32" height="32" /> </div> <div class="image0th"> <img src="'+this.thumb.url+'" style="max-width:100%"> </div> <div class="user-name">'+this.owner.fullname+"</div> </div>"}),$item+="</div>",$thumbnails+=$item,$count++}),t(".fbstories-items").append($thumbnails),function(){if(t.each(t(".fbstories-item"),function(e){t(this).attr("data-index",e+1)}),!t(".fbstories-item").length<0)return!1;t(".fbstories-item").length&&($total=t(".fbstories-item").length,t(".fbstories-items").attr("data-total",$total),t(".fbstories-items").attr("data-current",1),t(".fbstories-items").attr("data-pages",Math.ceil($total/l.page_limit)),t("#fbstories-paginate-1").fadeIn()),t("body").on("click",".fbstories-item-next",function(){$pages=parseInt(t(".fbstories-items").attr("data-pages")),$current=parseInt(t(".fbstories-items").attr("data-current")),$next=$current+1,$next<=$pages&&(t("#fbstories-paginate-"+$current).hide(),t("#fbstories-paginate-"+$next).fadeIn("slow"),t(".fbstories-items").attr("data-current",$next))}),t("body").on("click",".fbstories-item-previous",function(){$pages=parseInt(t(".fbstories-items").attr("data-pages")),$current=parseInt(t(".fbstories-items").attr("data-current")),$previous=$current-1,$previous<=$pages&&$previous>0&&(t("#fbstories-paginate-"+$current).hide(),t("#fbstories-paginate-"+$previous).fadeIn("slow"),t(".fbstories-items").attr("data-current",$previous))})}(),t("#fbstories-paginate-1").fadeIn()))}),t("body").on("click",".slideshow-container .close",function(){r=0,e=1,n=!1,clearInterval(s),clearInterval(a),t(".fbstories-container").hide(),t(".fbstories-container-inner").html("")}),t("body").on("click",".slideshow-container .slide-button",function(){clearInterval(a),c(parseInt(t(this).attr("data-index"))),a=setInterval(function(){0==n&&r>=100&&(c(1),e==i&&clearInterval(a))},100)}),t("body").on("click",".fbstories-item",function(){e=1,r=0,s=0,a=0,$json=JSON.parse(t(this).attr("data-items")),$json.owner.fullname&&($container='<div class="slideshow-container"> <div class="status-bar" style="display:none;"></div> <div class="close">&#10799;</div> <div class="users-information"> <div class="users-information-inner"> <div class="user-image"> <img src="'+$json.owner.icon+'" width="32" height="32" /> </div> <div class="user-name-time"> <span class="name">'+$json.owner.fullname+'</span> <span class="time"></span> </div> <div class="total-images"> <span class="current">1</span> <span>/</span> <span class="total">3</span> </div> </div> </div>',i=$json.files.length,t.each($json.files,function(){$container+='<div class="fbstories-slides fadefbstories" data-time="'+this.time+'" data-url="'+this.url+'" data-guid="'+this.guid+'"> <img src="'+this.url+'" style="max-width:100%"> <div class="text">'+this.title+"</div> </div>"}),$container+='<a class="prev slide-button"  data-index="-1">&#10094;</a> <a class="next slide-button" data-index="1">&#10095;</a> </div>',t(".fbstories-container-inner").html($container),t(".fbstories-container-inner .total-images .total").html($json.files.length),t(".fbstories-container").show(),u(e))}),a=setInterval(function(){0==n&&r>=100&&(e==i?clearInterval(a):c(1))},100),this}}(jQuery);
